{% extends 'finance_tracker/base_bootstrap.html' %}
{% load static %}

{% block title %}Dashboard - Personal Finance Tracker{% endblock %}

{% block content %}
<!-- Loading Indicator -->
<div class="loading-overlay" id="loading-indicator" style="display: none;">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading dashboard...</p>
    </div>
</div>

<!-- Welcome Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="welcome-text">
            Good {{ time_of_day }}, {{ user.first_name|default:user.username }}
        </div>
        <div class="welcome-sub-text">
            Here's your financial overview
        </div>
    </div>
</div>

<!-- Overview Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card overview-card income h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-wrapper me-3">
                        <i class="bi bi-arrow-down-left fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="card-category">Total Income</h6>
                        <h4 class="card-value" id="total-income">$0.00</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card overview-card expense h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-wrapper me-3">
                        <i class="bi bi-arrow-up-right fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="card-category">Total Expenses</h6>
                        <h4 class="card-value" id="total-expenses">$0.00</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card overview-card balance positive h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-wrapper me-3">
                        <i class="bi bi-wallet2 fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="card-category">Net Balance</h6>
                        <h4 class="card-value" id="net-balance">$0.00</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card overview-card h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="icon-wrapper me-3">
                        <i class="bi bi-bank fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="card-category">Active Accounts</h6>
                        <h4 class="card-value" id="account-count">0</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts and Quick Actions -->
<div class="row mb-4">
    <!-- Monthly Overview Chart -->
    <div class="col-lg-8 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-bar-chart me-2"></i>
                    Monthly Overview
                </h5>
                <button class="btn btn-sm btn-outline-primary" id="refresh-dashboard">
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    Refresh
                </button>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="col-lg-4 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-lightning me-2"></i>
                    Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <a href="{% url 'add_transaction' %}" class="quick-action-btn text-decoration-none d-block text-center">
                            <i class="bi bi-plus-circle fs-1 mb-2"></i>
                            <small>Add Transaction</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'upload_transactions' %}" class="quick-action-btn text-decoration-none d-block text-center">
                            <i class="bi bi-upload fs-1 mb-2"></i>
                            <small>Import CSV</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'spreadsheet_transactions' %}" class="quick-action-btn text-decoration-none d-block text-center">
                            <i class="bi bi-table fs-1 mb-2"></i>
                            <small>Spreadsheet</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'visualization_hub' %}" class="quick-action-btn text-decoration-none d-block text-center">
                            <i class="bi bi-graph-up fs-1 mb-2"></i>
                            <small>Visualizations</small>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Transactions and Accounts -->
<div class="row">
    <!-- Recent Transactions -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-clock-history me-2"></i>
                    Recent Transactions
                </h5>
                <div class="d-flex gap-2">
                    <a href="{% url 'query_transactions' %}" class="btn btn-sm btn-outline-primary">
                        View All
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div id="recent-transactions-list">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Summary -->
    <div class="col-lg-4">
        
        <!-- Account Summary Card -->
        <div class="card dashboard-card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Account Summary</h5>
                <a href="{% url 'manage_bank_accounts' %}" class="btn btn-sm btn-outline-primary">Manage</a>
            </div>
            <div class="card-body" id="account-summary-list">
                <!-- Account summary content will be loaded here by JS -->
                <div class="text-center p-3 text-muted">Loading accounts...</div>
            </div>
        </div>

        <!-- Budgets Card -->
        <div class="card dashboard-card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Budget Overview</h5>
                <a href="{% url 'manage_budgets' %}" class="btn btn-sm btn-outline-primary">Manage</a>
            </div>
            <div class="card-body">
                <div class="budget-summary mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span class="text-muted">Spent:</span>
                        <span class="fw-bold" id="total-spent-amount">$0.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Budget:</span>
                        <span class="fw-bold" id="total-budget-amount">$0.00</span>
                    </div>
                    <div class="progress budget-progress mb-2" style="height: 8px;">
                        <div class="progress-bar" role="progressbar" id="budget-progress-bar" style="width: 0%"></div>
                    </div>
                    <small class="text-muted" id="overall-budget-status">No budgets set</small>
                </div>
                <div id="budget-items-container">
                    <!-- Budget items will be loaded here by JS -->
                </div>
            </div>
        </div>

        <!-- Subscriptions Card -->
        <div class="card dashboard-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Active Subscriptions</h5>
                <a href="{% url 'manage_subscriptions' %}" class="btn btn-sm btn-outline-primary">Manage</a>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush" id="subscriptions-list">
                    <li class="list-group-item text-muted">Loading subscriptions...</li>
                </ul>
            </div>
        </div>
    </div>
</div>





{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="{% static 'js/custom_dashboard.js' %}"></script>
{% endblock %}

{% endblock %}