{% extends "base_bootstrap.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
<style>
    .btn.btn-outline-primary.position-fixed { display: none !important; }
    .spreadsheet-container {
        height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 0;
        margin: 0;
    }
    .spreadsheet-toolbar {
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
        min-height: 48px;
    }
    .spreadsheet-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    #transaction-spreadsheet {
        flex: 1;
        width: 100%;
        height: 100%;
        min-height: 0;
    }
    .spreadsheet-status {
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
        padding: 8px 16px;
        font-size: 13px;
        flex-shrink: 0;
    }
    .toolbar-btn {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 4px;
        border: 1px solid #dadce0;
        background: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .toolbar-btn:hover { background: #f1f3f4; }
    .toolbar-btn.primary { background: #1a73e8; color: white; border-color: #1a73e8; }
    .toolbar-btn.primary:hover { background: #1557b0; }
    .toolbar-separator { width: 1px; height: 20px; background: #dadce0; margin: 0 4px; }
    .handsontable { font-family: 'Roboto', 'Arial', sans-serif; font-size: 13px; }
    .handsontable .htInvalid { background-color: #fce8e6 !important; }
    .handsontable .htDimmed { color: #5f6368; }
    .handsontable .htCore { border: none; }
    .handsontable td { border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; }
    .handsontable th { background: #f8f9fa; border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; font-weight: 500; color: #3c4043; }
    body.dark-theme .spreadsheet-toolbar, body.dark-theme .spreadsheet-status { background: #2d2d2d; border-color: #444; color: #e1e1e1; }
    body.dark-theme .toolbar-btn { background: #3c4043; border-color: #5f6368; color: #e1e1e1; }
    body.dark-theme .toolbar-btn:hover { background: #48494a; }
    body.dark-theme .handsontable td { border-color: #444; background: #2d2d2d; color: #e1e1e1; }
    body.dark-theme .handsontable th { background: #3c4043; border-color: #444; color: #e1e1e1; }
</style>
{% endblock %}

{% block content %}
<div class="spreadsheet-container">
    <!-- Toolbar -->
    <div class="spreadsheet-toolbar">
        <h5 class="mb-0 me-3">Transaction Spreadsheet</h5>
        <button id="save-spreadsheet-btn" class="toolbar-btn primary">
            <i class="mdi mdi-content-save"></i> Save
        </button>
        <button id="add-row-btn" class="toolbar-btn">
            <i class="mdi mdi-plus"></i> Add Row
        </button>
        <button id="delete-row-btn" class="toolbar-btn">
            <i class="mdi mdi-delete"></i> Delete Row
        </button>
        <div class="toolbar-separator"></div>
        <button id="undo-btn" class="toolbar-btn" title="Undo">
            <i class="mdi mdi-undo"></i>
        </button>
        <button id="redo-btn" class="toolbar-btn" title="Redo">
            <i class="mdi mdi-redo"></i>
        </button>
        <div class="toolbar-separator"></div>
        <a href="{% url 'dashboard' %}" class="toolbar-btn">
            <i class="mdi mdi-arrow-left"></i> Dashboard
        </a>
    </div>
    <!-- Spreadsheet Content -->
    <div class="spreadsheet-content">
        <div id="transaction-spreadsheet"></div>
    </div>
    <!-- Status Bar -->
    <div id="status-message" class="spreadsheet-status">
        Ready
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected transaction(s)? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-spreadsheet-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>
{% csrf_token %}

<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<script src="{% static 'js/spreadsheet.js' %}"></script>
{% endblock %}